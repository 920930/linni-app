"use strict";const e=require("../../common/vendor.js"),o=require("./validator.js"),s=require("../../uni_modules/uni-id-pages/common/login-page.mixin.js");require("../../uni_modules/uni-id-pages/common/store.js"),require("../../uni_modules/uni-id-pages/common/password.js"),require("../../uni_modules/uni-id-pages/config.js");const a=e.Ds.importObject("uni-id-co"),r={mixins:[s.mixin],data:()=>({formData:{username:"",mobile:"",nickname:"",address:"",password:"",password2:"",role:"supplier",cars:[],code:""},rules:o.rules,focusMobile:!1,focusUsername:!1,focusNickname:!1,focusPassword:!1,focusPassword2:!1,userType:[{role:"supplier",name:"供货商"},{role:"member",name:"员工"}]}),onReady(){this.$refs.form.setRules(this.rules)},onShow(){},computed:{name(){return this.userType.find((e=>e.role===this.formData.role)).name},smsbool(){return/^1[3-9]{1}\d{9}$/.test(this.formData.mobile)}},methods:{changeTitle(o="supplier"){this.formData.role=o,e.index.setNavigationBarTitle({title:this.name+"注册"})},submit(){this.$refs.form.validate().then((o=>{if(this.formData.code.length<2)return e.index.showToast({title:"请输入手机验证码",icon:"none",duration:3e3});if(o.address.length<5)return e.index.showToast({title:"请输入地址",icon:"none",duration:3e3});if("member"!==this.formData.role){if(!o.cars.length)return e.index.showToast({title:"请增加车牌号",icon:"none",duration:3e3});if(o.cars.some((e=>!/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1,3}$/.test(e))))return e.index.showToast({title:"车牌号错误",icon:"none",duration:3e3})}if(this.needAgreements&&!this.agree)return this.$refs.agreements.popup((()=>{this.submitForm(o)}));this.submitForm(o)})).catch((e=>{let o=e[0].key;o=o.replace(o[0],o[0].toUpperCase()),this["focus"+o]=!0}))},submitForm(e){a.registerAppUser(this.formData).then((e=>{this.loginSuccess(e)})).catch((e=>{console.log(e.message)}))},navigateBack(){e.index.navigateBack()},toLogin(){e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withpwd"})},registerByEmail(){e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/register/register-by-email"})},manBtn(o){e.index.chooseLocation({success:e=>{this.formData.address=e.address}})},removeCar(e){this.formData.cars=this.formData.cars.filter((o=>o!=e))},dialogInputConfirm(e){const o=new Set(this.formData.cars);o.add(e),this.formData.cars=[...o],this.$refs.inputClose.val=""}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-tag")+e.resolveComponent("uni-id-pages-agreements")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-id-pages-sms-form"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-tag/components/uni-tag/uni-tag.js")+(()=>"../../uni_modules/uni-id-pages/components/uni-id-pages-agreements/uni-id-pages-agreements.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-id-pages/components/uni-id-pages-sms-form/uni-id-pages-sms-form.js"))();const i=e._export_sfc(r,[["render",function(o,s,a,r,i,t){return e.e({a:e.t(t.name),b:e.o((e=>i.focusNickname=!1)),c:e.o((e=>i.formData.nickname=e)),d:e.p({inputBorder:!1,focus:i.focusNickname,placeholder:`请输入${t.name}名称`,trim:"both",modelValue:i.formData.nickname}),e:e.p({name:"nickname",required:!0}),f:e.o((e=>i.focusMobile=!1)),g:e.o((e=>i.formData.mobile=e)),h:e.p({inputBorder:!1,focus:i.focusMobile,placeholder:"请输入手机号",trim:"both",modelValue:i.formData.mobile}),i:t.smsbool},t.smsbool?{j:e.o((e=>o.$refs.smsDialog.open()))}:{},{k:e.p({name:"mobile",required:!0}),l:e.o(((...e)=>t.manBtn&&t.manBtn(...e))),m:e.o((e=>i.formData.address=e)),n:e.p({placeholder:`${t.name}地址选择`,trim:"both",inputBorder:!1,modelValue:i.formData.address}),o:e.p({name:"address",required:!0}),p:e.f(i.formData.cars,((o,s,a)=>({a:o,b:e.o((e=>t.removeCar(o)),o),c:"748ca9ec-8-"+a+",748ca9ec-7",d:e.p({text:o+" ×"})}))),q:e.o((e=>o.$refs.inputDialog.open())),r:e.p({text:"添加车牌",type:"success"}),s:e.p({name:"cars",required:!0}),t:e.t(t.name),v:e.o((e=>i.focusUsername=!1)),w:e.o((e=>i.formData.username=e)),x:e.p({inputBorder:!1,focus:i.focusUsername,placeholder:"请输入登录账户",trim:"both",modelValue:i.formData.username}),y:e.p({name:"username",required:!0}),z:e.o((e=>i.focusPassword=!1)),A:e.o((e=>i.formData.password=e)),B:e.p({inputBorder:!1,focus:i.focusPassword,maxlength:"20",placeholder:"请输入"+("weak"==o.config.passwordStrength?"6":"8")+"-16位密码",type:"password",trim:"both",modelValue:i.formData.password}),C:e.o((e=>i.formData.password=e)),D:e.p({name:"password",required:!0,modelValue:i.formData.password}),E:e.o((e=>i.focusPassword2=!1)),F:e.o((e=>i.formData.password2=e)),G:e.p({inputBorder:!1,focus:i.focusPassword2,placeholder:"再次输入密码",maxlength:"20",type:"password",trim:"both",modelValue:i.formData.password2}),H:e.o((e=>i.formData.password2=e)),I:e.p({name:"password2",required:!0,modelValue:i.formData.password2}),J:e.sr("agreements","748ca9ec-16,748ca9ec-0"),K:e.p({scope:"register"}),L:e.o(((...e)=>t.submit&&t.submit(...e))),M:e.o(((...e)=>t.navigateBack&&t.navigateBack(...e))),N:e.o(((...e)=>t.registerByEmail&&t.registerByEmail(...e))),O:e.o(((...e)=>t.toLogin&&t.toLogin(...e))),P:e.sr("form","748ca9ec-0"),Q:e.p({value:i.formData,rules:i.rules,"validate-trigger":"submit","err-show-type":"toast"}),R:e.sr("inputClose","748ca9ec-18,748ca9ec-17"),S:e.o(t.dialogInputConfirm),T:e.p({mode:"input",title:"车牌号",placeholder:"请输入车牌号"}),U:e.sr("inputDialog","748ca9ec-17"),V:e.p({type:"dialog"}),W:e.sr("smsCode","748ca9ec-21,748ca9ec-20"),X:e.o((e=>i.formData.code=e)),Y:e.p({focusCaptchaInput:!0,type:"login-by-sms",phone:i.formData.mobile,modelValue:i.formData.code}),Z:e.p({title:"输入内容"}),aa:e.sr("smsDialog","748ca9ec-19"),ab:e.p({type:"dialog"}),ac:e.f(i.userType.filter((e=>e.role!=i.formData.role)),((o,s,a)=>({a:e.t(o.name),b:e.o((e=>t.changeTitle(o.role)),o.role),c:o.role})))})}]]);wx.createPage(i);
